---
layout: default
---

<div class="container mt-5">
  <div class="row">
    <div class="col-12">
      {% assign cat_key = page.category | downcase %}
      {% if cat_key == 'spiritualita-pratica' or cat_key == 'filosofia-pratica' %}
        {% assign display_title = 'Filosofia pratica' %}
      {% else %}
        {% assign display_title = page.title | default: page.category | replace: '-', ' ' | capitalize %}
      {% endif %}
      <h1 class="display-4 mb-3">{{ display_title }}</h1>

      {% if page.description %}
      <p class="lead text-muted mb-4">{{ page.description }}</p>
      {% endif %}

      <!-- Promessa / valore rapido -->
      <div class="mb-4">
        {% if page.promise %}
        <p class="fs-5">{{ page.promise }}</p>
        {% endif %}
      </div>

      <div class="row">
        <div class="col-lg-8">
          <!-- Guide essenziali (cornerstone) -->
          <section class="mb-5">
            <h2>Guide essenziali</h2>
            <div class="list-group mb-3">
              {% assign cat_posts = site.categories[page.category] | sort: 'date' | reverse %}
              {% assign guides = cat_posts | where_exp: "p", "p.tags contains 'cornerstone'" %}
              {% if guides.size > 0 %}
                {% for post in guides limit:5 %}
                <a class="list-group-item list-group-item-action" href="{{ post.url }}">{{ post.title }}</a>
                {% endfor %}
              {% else %}
                <p class="text-muted">Nessuna guida segnata come cornerstone. Verranno qui mostrate le guide principali della categoria.</p>
              {% endif %}
            </div>
          </section>

          <!-- Ultimi articoli -->
          <section class="mb-5">
            <h2>Ultimi articoli</h2>
            <div class="row">
              {% for post in cat_posts limit:12 %}
              <div class="col-md-6 mb-4">
                <div class="card h-100">
                  <a href="{{ post.url }}" class="text-decoration-none text-dark">
                    <img src="{{ post.background | default: '/assets/images/default-post.jpg' }}" class="card-img-top" alt="{{ post.title }}" style="height:160px;object-fit:cover;">
                  </a>
                  <div class="card-body">
                    <a href="{{ post.url }}" class="text-decoration-none text-dark"><h5 class="card-title">{{ post.title }}</h5></a>
                    <p class="card-text">{{ post.excerpt | strip_html | truncatewords:18 }}</p>
                    <p class="text-muted small mb-0">{{ post.date | date: "%d/%m/%Y" }}</p>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </section>

          <!-- FAQ se presente in front matter -->
          {% comment %} Prefer page.faq, fallback to site.data.category_faqs using normalized key {% endcomment %}
          {% assign faq_items = nil %}
          {% comment %} allow legacy key 'spiritualita-pratica' to use 'filosofia-pratica' FAQs {% endcomment %}
          {% assign faq_key = cat_key %}
          {% if cat_key == 'spiritualita-pratica' %}
            {% assign faq_key = 'filosofia-pratica' %}
          {% endif %}
          {% comment %} Prefer centralized data file first; fall back to page.faq if data absent {% endcomment %}
          {% assign faq_items = site.data.category_faqs[faq_key] %}
          {% if faq_items == nil or faq_items == empty or faq_items.size == 0 %}
            {% if page.faq and page.faq.size > 0 %}
              {% assign faq_items = page.faq %}
            {% endif %}
          {% endif %}

          {% if faq_items and faq_items.size > 0 %}
          <section class="mb-5">
            <h2>FAQ</h2>
            <div class="accordion" id="categoryFaq">
              {% for item in faq_items %}
              <div class="accordion-item">
                <h3 class="accordion-header" id="faqHeading{{ forloop.index }}">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse{{ forloop.index }}" aria-expanded="false" aria-controls="faqCollapse{{ forloop.index }}">{{ item.question }}</button>
                </h3>
                <div id="faqCollapse{{ forloop.index }}" class="accordion-collapse collapse" aria-labelledby="faqHeading{{ forloop.index }}" data-bs-parent="#categoryFaq">
                  <div class="accordion-body">{{ item.answer }}</div>
                </div>
              </div>
              {% endfor %}
            </div>
          </section>

          {%- comment -%} JSON-LD FAQPage for rich results {%- endcomment -%}
          <script type="application/ld+json">
          {
            "@context": "https://schema.org",
            "@type": "FAQPage",
            "mainEntity": [
              {% for item in faq_items %}
              {
                "@type": "Question",
                "name": {{ item.question | jsonify }},
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": {{ item.answer | jsonify }}
                }
              }{% if forloop.last == false %},{% endif %}
              {% endfor %}
            ]
          }
          </script>
          {% endif %}
          
          <!-- Small JS fallback to make accordion work without Bootstrap JS -->
          <script>
          (function(){
            // If Bootstrap's collapse is available, prefer it.
            if (typeof bootstrap !== 'undefined' && bootstrap && bootstrap.Collapse) return;

            function findClosest(el, sel){
              while(el && el.nodeType===1){ if(el.matches(sel)) return el; el = el.parentElement; } return null;
            }

            document.addEventListener('click', function(e){
              var btn = e.target.closest && e.target.closest('.accordion-button');
              if(!btn) return;
              // respect native links
              if (btn.tagName === 'A' && btn.href) return;

              var targetSel = btn.getAttribute('data-bs-target') || ('#' + btn.getAttribute('aria-controls'));
              if(!targetSel) return;
              var target = document.querySelector(targetSel);
              if(!target) return;

              var accordion = findClosest(btn, '.accordion');
              // close other open items in same accordion (accordion behavior)
              if(accordion){
                var openItems = accordion.querySelectorAll('.accordion-collapse.show');
                openItems.forEach(function(it){ if(it !== target){ it.classList.remove('show'); var relatedBtn = accordion.querySelector('[data-bs-target="#'+it.id+'"]'); if(relatedBtn){ relatedBtn.classList.add('collapsed'); relatedBtn.setAttribute('aria-expanded','false'); } }});
              }

              // toggle target
              var isOpen = target.classList.contains('show');
              if(isOpen){
                target.classList.remove('show');
                btn.classList.add('collapsed');
                btn.setAttribute('aria-expanded','false');
              } else {
                target.classList.add('show');
                btn.classList.remove('collapsed');
                btn.setAttribute('aria-expanded','true');
              }

              e.preventDefault();
            });
          })();
          </script>

        </div>

        <aside class="col-lg-4">
          <!-- Strumenti / Template -->
          <div class="mb-4">
            <h3>Strumenti e template</h3>
            <ul class="list-unstyled">
              {% for t in site.data.tools[page.category] limit:10 %}
              <li><a href="{{ t.url }}">{{ t.title }}</a></li>
              {% endfor %}
            </ul>
          </div>

          <!-- CTA Newsletter (semplificata: istruzioni verso contatti) -->
          <div class="card border-primary mb-4">
            <div class="card-body">
              <h4>Iscriviti alla newsletter</h4>
              <p class="small text-muted">Ricevi consigli pratici e template ogni settimana. Nessun hype, solo cose utili.</p>
              <p class="small text-muted">Per iscriverti, usa la pagina dei contatti e indica nel messaggio che vuoi iscriverti alla newsletter; specifica il tuo <strong>nome</strong> e la tua <strong>email</strong>.</p>
              <a href="/contact" class="btn btn-primary w-100" title="Vai ai contatti">Vai alla pagina Contatti</a>
            </div>
          </div>

        </aside>
      </div>

      <!-- JSON-LD CollectionPage + ItemList -->
      {% assign json_items = "" %}
      {% assign idx = 0 %}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": {{ page.title | jsonify }},
        "description": {{ page.description | default: page.excerpt | strip_html | truncate:160 | jsonify }},
        "mainEntity": {
          "@type": "ItemList",
          "itemListElement": [
            {% for post in cat_posts limit:20 %}
            {
              "@type": "ListItem",
              "position": {{ forloop.index }},
              "url": "{{ site.url }}{{ post.url }}"
            }{% if forloop.last == false %},{% endif %}
            {% endfor %}
          ]
        }
      }
      </script>
    </div>
  </div>
</div>