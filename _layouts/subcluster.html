---
layout: default
---
{% comment %}
  SUBCLUSTER LAYOUT - SEO MODERN v3 - ALIGNED WITH CATEGORY
  - Identico stile e struttura del layout category
  - Hero con CTA button "Inizia da qui"
  - Paginazione: 9 post/pagina con canonical autoreferenziale
  - H1 fisso, "Pagina N" solo nel title
  - Grid 2x2 "Cosa troverai qui" (opzionale)
  - Guide essenziali (cornerstone) con thumbnail 16:9
  - Lista post in stile featured-card con ratio 16:9
  - FAQ accordion Bootstrap
  - CTA Newsletter stile home
  - Schema: CollectionPage + ItemList + BreadcrumbList + FAQPage
  - CWV target: SEO ≥95, CLS ≤0.10, LCP ≤2.7s
{% endcomment %}

{% comment %} Determina slug categoria e subcluster {% endcomment %}
{% if page.category and page.category != '' %}
  {% assign cat_slug = page.category | downcase | strip %}
{% else %}
  {% assign cat_slug = page.categories | first | downcase | strip %}
{% endif %}

{% assign sub_slug = page.subcluster | downcase | strip %}

{% comment %} Mappa slug a display title {% endcomment %}
{% assign display_title = page.title | default: page.subcluster | replace: '-', ' ' | capitalize %}

{% comment %} Raccogli TUTTI i post del subcluster (senza paginazione) {% endcomment %}
{% assign sub_posts = site.posts 
  | where_exp: "p", "p.categories contains cat_slug" 
  | where: "subcluster", sub_slug 
  | sort: "date" 
  | reverse %}

{% comment %} Hero Component - Stile Category con CTA {% endcomment %}
{% include subcluster-hero.html %}

<div class="container category-container">
  <div class="row">
    <div class="col-12">

      {% comment %} Breadcrumb {% endcomment %}
      <div class="mb-3">
        {% include breadcrumb.html %}
      </div>

      {% comment %} Intro Section - Grid 2x2 "Cosa troverai qui" {% endcomment %}
      {% include subcluster-intro.html %}
      
      {% comment %} Blocco fisso Metodo I.R.O.N.I.A. - Solo per subcluster metodo-ironia {% endcomment %}
      {% if sub_slug == "metodo-ironia" %}
      
      {% comment %} Raccogli i 6 post cornerstone del metodo in ordine I-R-O-N-I-A {% endcomment %}
      {% assign ironia_slugs = "identificare-cosa-accade-dentro-te,ridimensiona-il-dramma-mentale,osservare-senza-interpretare,nomina-cio-che-senti,interrompere-il-pilota-automatico,agisci-per-interrompere-il-loop" | split: "," %}
      {% assign ironia_posts = "" | split: "," %}
      {% for slug in ironia_slugs %}
        {% assign found_post = site.posts | where: "slug", slug | first %}
        {% if found_post %}
          {% assign ironia_posts = ironia_posts | push: found_post %}
        {% endif %}
      {% endfor %}
      
      <section class="method-ironia-section mb-5" aria-labelledby="method-heading">
        <div class="row mb-4">
          <div class="col-12">
            <h2 id="method-heading" class="section-heading mb-2">Metodo I.R.O.N.I.A.</h2>
            <p class="text-muted mb-0">Sei fasi per interrompere il loop mentale e tornare al presente</p>
          </div>
        </div>
        
        {% comment %} Riga 1: I - R - O {% endcomment %}
        <div class="row g-4 align-items-stretch mb-4">
          {% for post in ironia_posts limit:3 %}
          <div class="col-12 col-md-4">
            <article class="mm-card h-100 rounded-3 overflow-hidden">
              <a href="{{ post.url | relative_url }}" class="text-decoration-none">
                {% if post.background or post.image %}
                <div class="thumb ratio ratio-16x9 overflow-hidden">
                  <img src="{{ post.background | default: post.image }}" alt="{{ post.title }}" loading="lazy" decoding="async" class="w-100 h-100" style="object-fit: cover;">
                </div>
                {% endif %}
                <div class="p-4">
                  <h3 class="h5 mb-2"><span class="text-dark">{{ post.title }}</span></h3>
                  {% assign post_desc = post.description | default: post.seo_description | default: post.excerpt %}
                  {% if post_desc %}
                  <p class="text-muted mb-3">{{ post_desc | strip_html | truncatewords: 15 }}</p>
                  {% endif %}
                  <span class="btn btn-sm btn-outline-primary">Leggi</span>
                </div>
              </a>
            </article>
          </div>
          {% endfor %}
        </div>
        
        {% comment %} Riga 2: N - I - A {% endcomment %}
        <div class="row g-4 align-items-stretch">
          {% for post in ironia_posts offset:3 limit:3 %}
          <div class="col-12 col-md-4">
            <article class="mm-card h-100 rounded-3 overflow-hidden">
              <a href="{{ post.url | relative_url }}" class="text-decoration-none">
                {% if post.background or post.image %}
                <div class="thumb ratio ratio-16x9 overflow-hidden">
                  <img src="{{ post.background | default: post.image }}" alt="{{ post.title }}" loading="lazy" decoding="async" class="w-100 h-100" style="object-fit: cover;">
                </div>
                {% endif %}
                <div class="p-4">
                  <h3 class="h5 mb-2"><span class="text-dark">{{ post.title }}</span></h3>
                  {% assign post_desc = post.description | default: post.seo_description | default: post.excerpt %}
                  {% if post_desc %}
                  <p class="text-muted mb-3">{{ post_desc | strip_html | truncatewords: 15 }}</p>
                  {% endif %}
                  <span class="btn btn-sm btn-outline-primary">Leggi</span>
                </div>
              </a>
            </article>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      {% comment %} Cornerstone Section (Guide essenziali) - Salta per metodo-ironia {% endcomment %}
      {% unless sub_slug == "metodo-ironia" %}
        {% include cornerstone-section.html category=cat_slug subcluster=sub_slug %}
      {% endunless %}

      {% comment %} Lista Post - Stile featured-card come category {% endcomment %}
      <section class="listing mb-5" aria-labelledby="posts-heading">
        <div class="row mb-3">
          <div class="col-12 d-flex align-items-center">
            <h2 id="posts-heading" class="section-heading mb-0">Ultimi articoli</h2>
            {% if sub_posts.size > 6 %}
            <a href="/archivio/?tema={{ sub_slug | slugify }}" class="btn btn-primary px-4 ms-auto" aria-label="Vedi tutti gli articoli di {{ display_title }}">Tutti gli articoli</a>
            {% endif %}
          </div>
        </div>
        
        {% for post in sub_posts limit:6 %}
        <div class="row mb-4">
          <div class="col-12">
            <article class="featured-card mm-card border rounded-3 shadow-sm overflow-hidden">
              <div class="row g-0">
                {% assign post_img = post.background | default: post.image %}
                {% if post_img %}
                <div class="col-md-6">
                  <div class="thumb ratio ratio-16x9">
                    <img 
                      src="{{ post_img | relative_url }}" 
                      alt="{{ post.title }}"
                      loading="lazy"
                      decoding="async"
                      width="600"
                      height="338"
                      sizes="(max-width: 768px) 100vw, 50vw"
                      class="w-100 h-100"
                      style="object-fit: cover;">
                  </div>
                </div>
                {% endif %}
                <div class="col-md-6">
                  <div class="card-body p-4">
                    <h3 class="post-title mb-3 h5">
                      <a href="{{ post.url | relative_url }}" class="text-decoration-none">
                        {{ post.title }}
                      </a>
                    </h3>
                    
                    {% assign post_excerpt = post.description | default: post.seo_description | default: post.excerpt %}
                    {% if post_excerpt %}
                      <p class="post-excerpt text-muted mb-4">{{ post_excerpt | strip_html | strip_newlines | truncate: 150 }}</p>
                    {% endif %}
                    
                    <div class="post-meta d-flex align-items-center justify-content-between flex-wrap mb-3">
                      <small class="text-muted">{{ post.date | date: '%d/%m/%Y' }}</small>
                      {% if post.subcluster %}
                      <a href="{{ page.url | relative_url }}" class="badge badge-mm text-decoration-none">
                        {{ post.subcluster | replace: '-', ' ' | capitalize }}
                      </a>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </article>
          </div>
        </div>
        {% endfor %}
      </section>

      {% comment %} FAQ Section - Accordion Bootstrap come category {% endcomment %}
      {% include category-faq.html category=cat_slug subcluster=sub_slug %}

      {% comment %} CTA Newsletter - Stile home/category {% endcomment %}
      <section class="cta cta-section mb-5" aria-labelledby="cta-heading">
        <div class="row justify-content-center">
          <div class="col-12">
            <div class="mm-card cta-newsletter p-5 border rounded-3 shadow-sm text-center mx-auto">
              <h2 id="cta-heading" class="h4 mb-3">{{ page.cta_title | default: "Ricevi 1 pratica a settimana" }}</h2>
              <p class="text-muted mb-4">{{ page.cta_text | default: "Zero spam. Una sola email con una micro‑tecnica testata sul campo." }}</p>
              <a href="{{ page.cta_link | default: '/newsletter' | relative_url }}" class="btn btn-primary px-4">{{ page.cta_button | default: "Iscriviti" }}</a>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>
</div>

{% comment %} Schema Markup - Centralizzato {% endcomment %}
{% include schema-subcluster.html 
  category=cat_slug 
  subcluster=sub_slug 
  posts=sub_posts 
  current_page=current_page 
  total_pages=total_pages %}
