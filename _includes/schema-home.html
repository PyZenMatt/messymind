{% comment %} Modern SEO Schema for Home Page {% endcomment %}
{% comment %} Get featured post and latest posts {% endcomment %}
{% assign featured_posts = site.posts | where: "featured_post", "true" %}
{% if featured_posts.size > 1 %}
  {% assign featured_posts = featured_posts | sort: "featured_rank" %}
{% endif %}
{% assign featured_post = featured_posts.first %}

{% assign latest_posts = site.posts %}
{% if featured_post %}
  {% assign latest_posts = site.posts | where_exp: "post", "post.url != featured_post.url" %}
{% endif %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "{{ page.h1 | default: site.home_h1 | default: site.title }}",
  "description": "{{ page.meta | default: site.description }}",
  "url": "{{ site.url }}{{ page.url }}",
  "isPartOf": {
    "@type": "WebSite",
    "name": "{{ site.title }}",
    "url": "{{ site.url }}"
  },
  "mainEntity": {
    "@type": "ItemList",
    "name": "Ultimi Articoli",
    "description": "Gli articoli pi√π recenti su mindfulness, burnout e filosofia pratica",
    "numberOfItems": {{ latest_posts.size | default: 8 }},
    "itemListElement": [
      {% for post in latest_posts limit:8 %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "item": {
          "@type": "BlogPosting",
          "headline": "{{ post.title | escape }}",
          "url": "{{ site.url }}{{ post.url }}",
          "datePublished": "{{ post.date | date_to_xmlschema }}",
          {% if post.date_modified %}
          "dateModified": "{{ post.date_modified | date_to_xmlschema }}",
          {% else %}
          "dateModified": "{{ post.date | date_to_xmlschema }}",
          {% endif %}
          "author": {
            "@type": "Person",
            "name": "{{ site.author | default: 'MessyMind' }}"
          },
          "image": "{{ site.url }}{{ post.background | default: '/img/default-post.jpg' }}",
          "description": "{{ post.description | default: post.excerpt | strip_html | truncatewords: 25 | escape }}"
        }
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}
</script>