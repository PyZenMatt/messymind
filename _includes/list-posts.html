{% comment %}
  List Posts - CWV Safe Post Cards
  - Aspect ratio fisso per prevenire CLS
  - Lazy loading + decoding async
  - Dimensioni esplicite width/height
  - Semantic HTML accessibile
{% endcomment %}

{% assign posts = include.posts | default: site.posts %}
{% assign limit = include.limit | default: 12 %}
{% assign show_date = include.show_date | default: true %}
{% assign show_excerpt = include.show_excerpt | default: true %}
{% assign grid_cols = include.grid_cols | default: 'col-md-6 col-lg-4' %}

<div class="posts-list">
  <div class="row g-4">
    {% for post in posts limit: limit %}
      <div class="{{ grid_cols }}">
        <article class="post-card card h-100 border-0 shadow-sm">
          <a href="{{ post.url | relative_url }}" class="text-decoration-none">
            <div class="card-img-wrapper" style="aspect-ratio: 16/9; overflow: hidden; background-color: #f8f9fa;">
              {% assign post_img = post.image | default: post.background | default: '/img/og-default.jpg' %}
              <img
                src="{{ post_img | relative_url }}"
                class="card-img-top"
                alt=""
                loading="lazy"
                decoding="async"
                width="600"
                height="338"
                sizes="(max-width: 768px) 100vw, (max-width: 992px) 50vw, 33vw"
                style="width: 100%; height: 100%; object-fit: cover; display: block;">
            </div>
            
            <div class="card-body d-flex flex-column">
              <h3 class="card-title h5 text-dark mb-2">
                {{ post.title }}
              </h3>
              
              {% if show_excerpt and post.description %}
                <p class="card-text text-muted flex-grow-1 mb-3" style="font-size: 0.9rem;">
                  {{ post.description | strip_html | truncatewords: 18 }}
                </p>
              {% elsif show_excerpt %}
                <p class="card-text text-muted flex-grow-1 mb-3" style="font-size: 0.9rem;">
                  {{ post.excerpt | strip_html | truncatewords: 18 }}
                </p>
              {% endif %}
              
              {% if show_date %}
                <div class="card-footer bg-transparent border-0 p-0 mt-auto">
                  <time datetime="{{ post.date | date_to_xmlschema }}" class="text-muted small">
                    {{ post.date | date: "%d/%m/%Y" }}
                  </time>
                </div>
              {% endif %}
            </div>
          </a>
        </article>
      </div>
    {% endfor %}
  </div>
</div>

<style>
/* Inline CSS for post cards - CLS prevention */
.post-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  overflow: hidden;
}

.post-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15) !important;
}

.post-card .card-img-wrapper {
  position: relative;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.post-card .card-body {
  padding: 1.25rem;
}

.post-card .card-title {
  color: var(--bs-dark, #212529);
  line-height: 1.3;
  font-weight: 600;
}

.post-card a:hover .card-title {
  color: var(--bs-primary, #4f8a8b);
}

.post-card .card-text {
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

@media (max-width: 767px) {
  .posts-list .row.g-4 {
    row-gap: 1.5rem !important;
  }
}
</style>
